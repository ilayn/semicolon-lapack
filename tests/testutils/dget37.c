/**
 * @file dget37.c
 * @brief DGET37 tests DTRSNA, a routine for estimating condition numbers of
 *        eigenvalues and/or right eigenvectors of a matrix.
 */

#include "verify.h"
#include <cblas.h>
#include <math.h>
#include <string.h>

extern f64  dlamch(const char* cmach);
extern f64  dlange(const char* norm, const int m, const int n,
                   const f64* A, const int lda, f64* work);
extern void dlacpy(const char* uplo, const int m, const int n,
                   const f64* A, const int lda, f64* B, const int ldb);
extern void dgehrd(const int n, const int ilo, const int ihi,
                   f64* A, const int lda, f64* tau,
                   f64* work, const int lwork, int* info);
extern void dhseqr(const char* job, const char* compz, const int n,
                   const int ilo, const int ihi,
                   f64* H, const int ldh, f64* wr, f64* wi,
                   f64* Z, const int ldz,
                   f64* work, const int lwork, int* info);
extern void dtrevc(const char* side, const char* howmny,
                   int* select, const int n,
                   const f64* T, const int ldt,
                   f64* VL, const int ldvl,
                   f64* VR, const int ldvr,
                   const int mm, int* m, f64* work, int* info);
extern void dtrsna(const char* job, const char* howmny,
                   const int* select, const int n,
                   const f64* T, const int ldt,
                   const f64* VL, const int ldvl,
                   const f64* VR, const int ldvr,
                   f64* S, f64* sep, const int mm, int* m,
                   f64* work, const int ldwork,
                   int* iwork, int* info);

#define LDT   20
#define LWORK (2 * LDT * (10 + LDT))

#define NCASES37 39

/*
 * Embedded test data from LAPACK dec.in lines 121-636.
 * 39 test cases. Format per case:
 *   n*n matrix values (row-major), then n*(wr,wi,s,sep) quadruplets.
 */
static const f64 dget37_data[] = {
    /* Case 0: N=1 */
    0.0,
    0.0, 0.0, 1.0, 0.0,

    /* Case 1: N=1 */
    1.0,
    1.0, 0.0, 1.0, 1.0,

    /* Case 2: N=2 */
    0.0, 0.0,
    0.0, 0.0,
    0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 1.0, 0.0,

    /* Case 3: N=2 */
    3.0, 2.0,
    2.0, 3.0,
    1.0, 0.0, 1.0, 4.0,
    5.0, 0.0, 1.0, 4.0,

    /* Case 4: N=2 */
    3.0, -2.0,
    2.0, 3.0,
    3.0, 2.0, 1.0, 4.0,
    3.0, -2.0, 1.0, 4.0,

    /* Case 5: N=6 */
    1.0000e-07, -1.0000e-07, 1.0, 1.1000, 2.3000, 3.7000,
    3.0000e-07, 1.0000e-07, 1.0, 1.0, -1.3000, -7.7000,
    0.0, 0.0, 3.0000e-07, 1.0000e-07, 2.2000, 3.3000,
    0.0, 0.0, -1.0000e-07, 3.0000e-07, 1.8000, 1.6000,
    0.0, 0.0, 0.0, 0.0, 4.0000e-06, 5.0,
    0.0, 0.0, 0.0, 0.0, 3.0, 4.0000e-06,
    -3.8730, 0.0, 0.6986, 2.2823,
    1.0000e-07, 1.7321e-07, 9.7611e-08, 5.0060e-14,
    1.0000e-07, -1.7321e-07, 9.7611e-08, 5.0060e-14,
    3.0000e-07, 1.0000e-07, 1.0000e-07, 9.4094e-14,
    3.0000e-07, -1.0000e-07, 1.0000e-07, 9.4094e-14,
    3.8730, 0.0, 0.4066, 1.5283,

    /* Case 6: N=4 */
    7.0, 1.0, 1.0, 1.0,
    -1.0, 1.0, 1.0, 1.0,
    -1.0, 1.0, 5.0, -3.0,
    1.0, -1.0, 3.0, 3.0,
    3.9603, 0.0404, 1.1244e-05, 3.1179e-05,
    3.9603, -0.0404, 1.1244e-05, 3.1179e-05,
    4.0397, 0.0389, 1.0807e-05, 2.9981e-05,
    4.0397, -0.0389, 1.0807e-05, 2.9981e-05,

    /* Case 7: N=5 */
    0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 1.9722e-31,
    0.0, 0.0, 1.0, 1.9722e-31,
    0.0, 0.0, 1.0, 1.9722e-31,
    0.0, 0.0, 1.0, 1.9722e-31,
    0.0, 0.0, 1.0, 1.9722e-31,

    /* Case 8: N=5 */
    1.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 1.0,
    1.0, 0.0, 1.0, 1.9722e-31,
    1.0, 0.0, 1.0, 1.9722e-31,
    1.0, 0.0, 1.0, 1.9722e-31,
    1.0, 0.0, 1.0, 1.9722e-31,
    1.0, 0.0, 1.0, 1.9722e-31,

    /* Case 9: N=6 */
    1.0, 1.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 1.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 1.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 1.0,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,

    /* Case 10: N=6 */
    1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    1.0, 1.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 1.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 1.0, 1.0,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,
    1.0, 0.0, 2.4074e-35, 2.4074e-35,

    /* Case 11: N=6 */
    1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 2.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 3.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 4.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 5.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 6.0,
    1.0, 0.0, 1.0, 1.0,
    2.0, 0.0, 1.0, 1.0,
    3.0, 0.0, 1.0, 1.0,
    4.0, 0.0, 1.0, 1.0,
    5.0, 0.0, 1.0, 1.0,
    6.0, 0.0, 1.0, 1.0,

    /* Case 12: N=4 */
    0.9448, 0.6767, 0.6908, 0.5965,
    0.5876, 0.8642, 0.6769, 0.0726,
    0.7256, 0.1943, 0.9687, 0.2831,
    0.2849, 0.0580, 0.4845, 0.7361,
    0.2433, 0.2141, 0.8710, 0.3507,
    0.2433, -0.2141, 0.8710, 0.3507,
    0.7409, 0.0, 0.9819, 0.4699,
    2.2864, 0.0, 0.9772, 1.5455,

    /* Case 13: N=6 */
    0.5041, 0.6652, 0.7719, 0.6387, 0.5955, 0.6131,
    0.1574, 0.3734, 0.5984, 0.1547, 0.9427, 0.0659,
    0.4417, 0.0723, 0.1544, 0.5492, 0.008700, 0.3004,
    0.2008, 0.6080, 0.3034, 0.8439, 0.2390, 0.5768,
    0.9361, 0.7413, 0.1444, 0.1786, 0.1428, 0.7263,
    0.5599, 0.9336, 0.0780, 0.4093, 0.6714, 0.5617,
    -0.5228, 0.0, 0.2789, 0.1179,
    -0.3538, 0.0, 0.3543, 0.0689,
    -0.008088, 0.0, 0.3456, 0.1349,
    0.3476, 0.3053, 0.5466, 0.1773,
    0.3476, -0.3053, 0.5466, 0.1773,
    2.7698, 0.0, 0.9664, 1.8270,

    /* Case 14: N=5 */
    0.002000, 1.0, 0.0, 0.0, 0.0,
    0.0, 0.001000, 1.0, 0.0, 0.0,
    0.0, 0.0, -0.001000, 1.0, 0.0,
    0.0, 0.0, 0.0, -0.002000, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0,
    -0.002000, 0.0, 2.4000e-11, 2.3952e-11,
    -0.001000, 0.0, 6.0000e-12, 5.9940e-12,
    0.0, 0.0, 4.0000e-12, 3.9920e-12,
    0.001000, 0.0, 6.0000e-12, 5.9940e-12,
    0.002000, 0.0, 2.4000e-11, 2.3952e-11,

    /* Case 15: N=10 */
    0.4863, 0.9126, 0.0219, 0.6011, 0.1405, 0.2084, 0.8264, 0.8441, 0.3142, 0.8675,
    0.7150, 0.2648, 0.8851, 0.2615, 0.5952, 0.4780, 0.7673, 0.4611, 0.5732, 0.007700,
    0.2121, 0.5508, 0.5235, 0.3081, 0.6602, 0.2890, 0.2314, 0.2279, 0.0966, 0.1091,
    0.7151, 0.8579, 0.5771, 0.5114, 0.1901, 0.9081, 0.6009, 0.7198, 0.1064, 0.8684,
    0.5680, 0.0281, 0.4014, 0.6315, 0.1148, 0.0758, 0.9423, 0.7203, 0.3685, 0.1743,
    0.7721, 0.3028, 0.5564, 0.9998, 0.3652, 0.5258, 0.3703, 0.6779, 0.9935, 0.5027,
    0.7396, 0.0456, 0.7474, 0.9288, 0.002200, 0.0826, 0.3634, 0.4912, 0.9405, 0.3891,
    0.5637, 0.8554, 0.0321, 0.2638, 0.3609, 0.6497, 0.8469, 0.9350, 0.0370, 0.2917,
    0.8656, 0.6327, 0.3562, 0.6356, 0.2736, 0.6512, 0.1022, 0.2888, 0.5762, 0.4079,
    0.5332, 0.4121, 0.7287, 0.2311, 0.6830, 0.7386, 0.8180, 0.9815, 0.8055, 0.2566,
    -0.4612, 0.7266, 0.4778, 0.1584,
    -0.4612, -0.7266, 0.4778, 0.1584,
    -0.4516, 0.0, 0.4603, 0.1993,
    -0.1492, 0.4825, 0.4750, 0.0917,
    -0.1492, -0.4825, 0.4750, 0.0917,
    0.0331, 0.0, 0.2973, 0.0825,
    0.3085, 0.1195, 0.4295, 0.0397,
    0.3085, -0.1195, 0.4295, 0.0397,
    0.5451, 0.0, 0.7078, 0.1503,
    5.0352, 0.0, 0.9726, 3.5548,

    /* Case 16: N=4 */
    -0.3873, 0.3656, 0.0312, -0.5834,
    0.5523, -1.1854, 0.9833, 0.7667,
    1.6746, -0.0199, -1.8293, 0.5718,
    -0.5250, 0.3534, -0.2721, -0.0883,
    -1.8952, 0.7506, 0.8191, 0.7709,
    -1.8952, -0.7506, 0.8191, 0.7709,
    -0.0952, 0.0, 0.8050, 0.4904,
    0.3952, 0.0, 0.9822, 0.4904,

    /* Case 17: N=6 */
    -1.0777, 1.7027, 0.2651, 0.8516, 1.0121, 0.2571,
    -0.0134, 0.3903, -1.2680, 0.2753, -0.3235, -1.3844,
    0.1523, 0.3068, 0.8733, -0.3341, -0.4831, -1.5416,
    0.1447, -0.6057, 0.0319, -1.0905, -0.0837, 0.6241,
    -0.7651, -1.7889, -1.5069, -0.6021, 0.5217, 0.6470,
    0.8194, 0.2110, 0.5432, 0.7561, 0.1713, 0.5540,
    -1.7029, 0.0, 0.6791, 0.6722,
    -1.0307, 0.0, 0.7267, 0.2044,
    0.2849, 1.2101, 0.3976, 0.4980,
    0.2849, -1.2101, 0.3976, 0.4980,
    1.1675, 0.4663, 0.4233, 0.1905,
    1.1675, -0.4663, 0.4233, 0.1905,

    /* Case 18: N=10 */
    -1.0639, 0.1612, 0.1562, 0.3436, -0.6748, 1.6598, 0.6465, -0.7863, -0.2610, 0.7019,
    -0.8440, -2.2439, 1.8800, -1.0005, 0.0745, -1.6156, 0.2822, 0.8560, 1.3497, -1.5883,
    1.5988, 1.1758, 1.2398, 1.1173, 0.2150, 0.4314, 0.1850, 0.7947, 0.6626, 0.8646,
    -0.2296, 1.2442, 2.3242, -0.5069, -0.7516, -0.5437, -0.2599, 1.2830, -1.1067, -0.1115,
    -0.3604, 0.4042, 0.6124, -1.2164, -0.9465, -0.3146, 0.1831, 0.7371, 1.4278, 0.2922,
    0.4615, 0.3874, -0.0429, -0.9360, 0.7116, -0.8259, -1.7640, -0.9466, 1.8202, -0.2548,
    1.2934, -0.9755, 0.6748, -1.0481, -1.8442, -0.0546, 0.7405, 0.006100, 1.2430, -0.1849,
    -0.3471, -0.9580, 0.1653, 0.0913, -0.5201, -1.1832, 0.8541, -0.2320, -1.6155, 0.5518,
    1.0190, -0.6824, 0.8085, 0.2595, -0.3758, -1.8825, 1.6473, -0.6592, 0.8025, -0.004900,
    1.2670, -0.0424, 0.8957, -0.1677, 0.1462, 0.9880, -0.2317, -1.4483, -0.0582, 0.0197,
    -2.6992, 0.9039, 0.6401, 0.4162,
    -2.6992, -0.9039, 0.6401, 0.4162,
    -2.4366, 0.0, 0.6908, 0.2548,
    -1.2882, 0.8893, 0.5343, 0.6088,
    -1.2882, -0.8893, 0.5343, 0.6088,
    0.9028, 0.0, 0.2980, 0.4753,
    0.9044, 2.5661, 0.7319, 0.6202,
    0.9044, -2.5661, 0.7319, 0.6202,
    1.6774, 0.0, 0.3074, 0.4173,
    3.0060, 0.0, 0.8562, 0.4318,

    /* Case 19: N=4 */
    -1.2298, -2.3142, -0.0698, 1.0523,
    0.2039, -1.2298, 0.0805, 0.9786,
    0.0, 0.0, 0.2560, -0.8910,
    0.0, 0.0, 0.2748, 0.2560,
    -1.2298, 0.6869, 0.4714, 0.7177,
    -1.2298, -0.6869, 0.4714, 0.7177,
    0.2560, 0.4948, 0.8096, 0.5141,
    0.2560, -0.4948, 0.8096, 0.5141,

    /* Case 20: N=6 */
    0.5993, 1.9372, -0.1616, -1.4602, 0.6018, 2.7120,
    -2.2049, 0.5993, -1.0679, 1.9405, -1.4400, -0.2211,
    0.0, 0.0, -2.4567, -0.6865, -1.9101, 0.6496,
    0.0, 0.0, 0.0, 0.7362, 0.3970, -0.1519,
    0.0, 0.0, 0.0, 0.0, -1.0034, 1.1954,
    0.0, 0.0, 0.0, 0.0, -0.1340, -1.0034,
    -2.4567, 0.0, 0.4709, 0.8579,
    -1.0034, 0.4002, 0.3689, 0.1891,
    -1.0034, -0.4002, 0.3689, 0.1891,
    0.5993, 2.0667, 0.5885, 1.3299,
    0.5993, -2.0667, 0.5885, 1.3299,
    0.7362, 0.0, 0.6085, 0.9673,

    /* Case 21: N=4 */
    1.0000e-04, 1.0, 0.0, 0.0,
    0.0, -1.0000e-04, 1.0, 0.0,
    0.0, 0.0, 0.0100, 1.0,
    0.0, 0.0, 0.0, -0.005000,
    -0.005000, 0.0, 3.7485e-07, 3.6932e-07,
    -1.0000e-04, 0.0, 9.8979e-09, 9.8493e-09,
    1.0000e-04, 0.0, 1.0098e-08, 1.0046e-08,
    0.0100, 0.0, 1.4996e-06, 1.4773e-06,

    /* Case 22: N=3 */
    2.0000e-06, 1.0, -2.0,
    1.0000e-06, -2.0, 4.0,
    0.0, 1.0, -2.0,
    -4.0, 0.0, 0.7303, 4.0,
    0.0, 0.0, 0.7280, 1.3726e-06,
    2.2096e-06, 0.0, 0.8276, 2.2096e-06,

    /* Case 23: N=6 */
    0.2408, 0.6553, 0.9166, 0.0503, 0.2849, 0.2408,
    0.6907, 0.9700, 0.1402, 0.5782, 0.6767, 0.6907,
    0.1062, 0.0380, 0.7054, 0.2432, 0.8642, 0.1062,
    0.2640, 0.0988, 0.0178, 0.9448, 0.1943, 0.2640,
    0.7034, 0.2560, 0.2611, 0.5876, 0.0580, 0.7034,
    0.4021, 0.5598, 0.1358, 0.7256, 0.6908, 0.4021,
    -0.3401, 0.3213, 0.5784, 0.2031,
    -0.3401, -0.3213, 0.5784, 0.2031,
    -1.6998e-07, 0.0, 0.4964, 0.2157,
    0.7231, 0.0594, 0.7004, 0.0419,
    0.7231, -0.0594, 0.7004, 0.0419,
    2.5551, 0.0, 0.9252, 1.7390,

    /* Case 24: N=6 */
    3.4800, -2.9900, 0.0, 0.0, 0.0, 0.0,
    -0.4900, 2.4800, -1.9900, 0.0, 0.0, 0.0,
    0.0, -0.4900, 1.4800, -0.9900, 0.0, 0.0,
    0.0, 0.0, -0.9900, 1.4800, -0.4900, 0.0,
    0.0, 0.0, 0.0, -1.9900, 2.4800, -0.4900,
    0.0, 0.0, 0.0, 0.0, -2.9900, 3.4800,
    0.0130, 0.0, 0.7530, 0.6053,
    1.1294, 0.0, 0.6048, 0.2861,
    2.0644, 0.0, 0.5466, 0.1738,
    2.8388, 0.0, 0.4277, 0.3091,
    4.3726, 0.0, 0.6637, 0.0764,
    4.4618, 0.0, 0.5739, 0.0892,

    /* Case 25: N=6 */
    0.0, 1.0, 0.0, 0.0, 0.0, 1.0,
    1.0, 0.0, 1.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 1.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0, 1.0, 0.0,
    0.0, 0.0, 0.0, 1.0, 0.0, 1.0,
    -1.0, 0.0, 0.0, 0.0, 1.0, 0.0,
    -1.7321, 0.0, 0.8660, 0.7260,
    -1.0, 0.0, 0.5000, 0.2642,
    0.0, 0.0, 2.9582e-31, 1.4600e-07,
    0.0, 0.0, 2.9582e-31, 6.2446e-08,
    1.0, 0.0, 0.5000, 0.2642,
    1.7321, 0.0, 0.8660, 0.3790,

    /* Case 26: N=6 */
    0.3534, 0.9302, 0.0747, -0.0101, 0.0467, -0.0435,
    0.9355, -0.3515, -0.0282, 0.003801, -0.0176, 0.0164,
    0.0, -0.1056, 0.7521, -0.1013, 0.4703, -0.4379,
    0.0, 0.0, 0.6542, 0.1178, -0.5468, 0.5091,
    0.0, 0.0, 0.0, -0.9878, -0.1140, 0.1061,
    0.0, 0.0, 0.0, 0.0, 0.6814, 0.7319,
    -0.9998, 0.0196, 1.0, 0.0393,
    -0.9998, -0.0196, 1.0, 0.0393,
    0.7454, 0.6666, 1.0, 0.5212,
    0.7454, -0.6666, 1.0, 0.5212,
    0.9993, 0.0375, 1.0, 0.0751,
    0.9993, -0.0375, 1.0, 0.0751,

    /* Case 27: N=6 */
    1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
    0.5000, 0.3333, 0.2500, 0.2000, 0.1667, 0.1429,
    0.3333, 0.2500, 0.2000, 0.1667, 0.1429, 0.1250,
    0.2500, 0.2000, 0.1667, 0.1429, 0.1250, 0.1111,
    0.2000, 0.1667, 0.1429, 0.1250, 0.1111, 0.1000,
    0.1667, 0.1429, 0.1250, 0.1111, 0.1000, 0.0909,
    -0.2213, 0.0, 0.4084, 0.1661,
    -0.0320, 0.0, 0.3793, 0.0305,
    -8.5031e-04, 0.0, 0.6279, 7.8195e-04,
    -5.8584e-05, 0.0, 0.8116, 7.2478e-05,
    1.3895e-05, 0.0, 0.9709, 7.2478e-05,
    2.1324, 0.0, 0.8433, 1.8048,

    /* Case 28: N=12 */
    12.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    11.0, 11.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 10.0, 10.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 9.0, 9.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 8.0, 8.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 7.0, 7.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 6.0, 6.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 5.0, 5.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 4.0, 4.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.0, 3.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 2.0, 1.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0,
    -0.0282, 0.0, 2.8690e-06, 3.2094e-06,
    0.0726, 0.0907, 1.5885e-06, 9.9934e-07,
    0.0726, -0.0907, 1.5885e-06, 9.9934e-07,
    0.1853, 0.0, 6.5757e-07, 7.8673e-07,
    0.2883, 0.0, 1.8324e-06, 2.0796e-06,
    0.6431, 0.0, 6.8640e-05, 6.1058e-05,
    1.5539, 0.0, 0.004626, 0.006403,
    3.5119, 0.0, 0.1445, 0.1947,
    6.9615, 0.0, 0.5845, 1.2016,
    12.3110, 0.0, 0.3182, 1.4273,
    20.1990, 0.0, 0.2008, 2.4358,
    32.2290, 0.0, 0.3042, 5.6865,

    /* Case 29: N=6 */
    0.0, 1.0, 0.0, 0.0, 0.0, 0.0,
    5.0, 0.0, 2.0, 0.0, 0.0, 0.0,
    0.0, 4.0, 0.0, 3.0, 0.0, 0.0,
    0.0, 0.0, 3.0, 0.0, 4.0, 0.0,
    0.0, 0.0, 0.0, 2.0, 0.0, 5.0,
    0.0, 0.0, 0.0, 0.0, 1.0, 0.0,
    -5.0, 0.0, 0.8229, 1.2318,
    -3.0, 0.0, 0.7228, 0.7597,
    -1.0, 0.0, 0.6285, 0.6967,
    1.0, 0.0, 0.6285, 0.6967,
    3.0, 0.0, 0.7228, 0.7597,
    5.0, 0.0, 0.8229, 1.2318,

    /* Case 30: N=6 */
    1.0, 0.0, 0.0, 0.0, 0.0, 1.0,
    -1.0, 1.0, 0.0, 0.0, 0.0, 1.0,
    -1.0, -1.0, 1.0, 0.0, 0.0, 1.0,
    -1.0, -1.0, -1.0, 1.0, 0.0, 1.0,
    -1.0, -1.0, -1.0, -1.0, 1.0, 1.0,
    -1.0, -1.0, -1.0, -1.0, -1.0, 1.0,
    0.0803, 2.4187, 0.8997, 1.5236,
    0.0803, -2.4187, 0.8997, 1.5236,
    1.4415, 0.6285, 0.9673, 0.4279,
    1.4415, -0.6285, 0.9673, 0.4279,
    1.4782, 0.1564, 0.9760, 0.2200,
    1.4782, -0.1564, 0.9760, 0.2200,

    /* Case 31: N=6 */
    0.0, 0.0, 0.0, 0.0, 0.0, 1.0,
    1.0, 1.0, 0.0, 0.0, 1.0, 1.0,
    0.0, 1.0, 1.0, 1.0, 0.0, 1.0,
    1.0, 0.0, 1.0, 1.0, 1.0, 1.0,
    1.0, 0.0, 1.0, 1.0, 1.0, 0.0,
    0.0, 1.0, 0.0, 1.0, 1.0, 1.0,
    -0.0353, 0.7481, 0.3935, 0.1842,
    -0.0353, -0.7481, 0.3935, 0.1842,
    5.8440e-07, 0.0, 0.2887, 0.1700,
    0.6409, 0.7282, 0.4501, 0.2943,
    0.6409, -0.7282, 0.4501, 0.2943,
    3.7889, 0.0, 0.9630, 2.2469,

    /* Case 32: N=6 */
    1.0, 4.0112, 12.7500, 40.2130, 126.5600, 397.8800,
    1.0, 3.2616, 10.6290, 33.3420, 104.7900, 329.3600,
    1.0, 3.1500, 9.8006, 30.6300, 96.1640, 302.1500,
    1.0, 3.2755, 10.4200, 32.9570, 103.7400, 326.1600,
    1.0, 2.8214, 8.4558, 26.2960, 82.4430, 258.9300,
    1.0, 2.6406, 8.3565, 26.5580, 83.5580, 262.6800,
    -0.5322, 0.0, 0.5329, 0.3856,
    -0.1012, 0.0, 0.7234, 0.0913,
    -0.009875, 0.0, 0.7371, 0.0110,
    0.002986, 0.0, 0.4461, 0.0129,
    0.1807, 0.0, 0.4288, 0.1738,
    392.6000, 0.0, 0.4806, 392.0100,

    /* Case 33: N=8 */
    0.0, 4.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    1.0, 0.0, 4.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 1.0, 0.0, 4.0, 0.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 1.0, 0.0, 4.0, 0.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 1.0, 0.0, 4.0, 0.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 4.0, 0.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 4.0,
    0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0,
    -3.7588, 0.0, 0.1225, 0.1298,
    -3.0642, 0.0, 0.0498, 0.0802,
    -2.0, 0.0, 0.0369, 0.0829,
    -0.6946, 0.0, 0.0333, 0.1374,
    0.6946, 0.0, 0.0333, 0.1117,
    2.0, 0.0, 0.0369, 0.0722,
    3.0642, 0.0, 0.0498, 0.0684,
    3.7588, 0.0, 0.1225, 0.1153,

    /* Case 34: N=6 */
    8.5000, -10.4720, 2.8944, -1.5279, 1.1056, -0.5000,
    2.6180, -1.1708, -2.0, 0.8944, -0.6180, 0.2764,
    -0.7236, 2.0, -0.1708, -1.6180, 0.8944, -0.3820,
    0.3820, -0.8944, 1.6180, 0.1708, -2.0, 0.7236,
    -0.2764, 0.6180, -0.8944, 2.0, 1.1708, -2.6180,
    0.5000, -1.1056, 1.5279, -2.8944, 10.4720, -8.5000,
    -0.5893, 0.0, 1.7357e-04, 2.8157e-04,
    -0.2763, 0.4985, 1.7486e-04, 1.6704e-04,
    -0.2763, -0.4985, 1.7486e-04, 1.6704e-04,
    0.2751, 0.5006, 1.7635e-04, 1.6828e-04,
    0.2751, -0.5006, 1.7635e-04, 1.6828e-04,
    0.5917, 0.0, 1.7623e-04, 3.0778e-04,

    /* Case 35: N=4 */
    4.0, -5.0, 0.0, 3.0,
    0.0, 4.0, -3.0, -5.0,
    5.0, -3.0, 4.0, 0.0,
    3.0, 0.0, 5.0, 4.0,
    1.0, 5.0, 1.0, 4.3333,
    1.0, -5.0, 1.0, 4.3333,
    2.0, 0.0, 1.0, 4.3333,
    12.0, 0.0, 1.0, 9.1250,

    /* Case 36: N=5 */
    15.0, 11.0, 6.0, -9.0, -15.0,
    1.0, 3.0, 9.0, -3.0, -8.0,
    7.0, 6.0, 6.0, -3.0, -11.0,
    7.0, 7.0, 5.0, -3.0, -11.0,
    17.0, 12.0, 5.0, -10.0, -16.0,
    -1.0000, 0.0, 0.2177, 0.5226,
    1.4980, 3.5752, 3.9966e-04, 0.006095,
    1.4980, -3.5752, 3.9966e-04, 0.006095,
    1.5020, 3.5662, 3.9976e-04, 0.006096,
    1.5020, -3.5662, 3.9976e-04, 0.006096,

    /* Case 37: N=6 */
    -9.0, 21.0, -15.0, 4.0, 2.0, 0.0,
    -10.0, 21.0, -14.0, 4.0, 2.0, 0.0,
    -8.0, 16.0, -11.0, 4.0, 2.0, 0.0,
    -6.0, 12.0, -9.0, 3.0, 3.0, 0.0,
    -4.0, 8.0, -6.0, 0.0, 5.0, 0.0,
    -2.0, 4.0, -3.0, 0.0, 1.0, 3.0,
    1.0, 6.2559e-04, 6.4875e-05, 5.0367e-04,
    1.0, -6.2559e-04, 6.4875e-05, 5.0367e-04,
    2.0, 1.0001, 0.0541, 0.2351,
    2.0, -1.0001, 0.0541, 0.2351,
    3.0, 0.0, 0.8615, 5.4838e-07,
    3.0, 0.0, 0.1242, 1.2770e-06,

    /* Case 38: N=10 */
    1.0, 1.0, 1.0, -2.0, 1.0, -1.0, 2.0, -2.0, 4.0, -3.0,
    -1.0, 2.0, 3.0, -4.0, 2.0, -2.0, 4.0, -4.0, 8.0, -6.0,
    -1.0, 0.0, 5.0, -5.0, 3.0, -3.0, 6.0, -6.0, 12.0, -9.0,
    -1.0, 0.0, 3.0, -4.0, 4.0, -4.0, 8.0, -8.0, 16.0, -12.0,
    -1.0, 0.0, 3.0, -6.0, 5.0, -4.0, 10.0, -10.0, 20.0, -15.0,
    -1.0, 0.0, 3.0, -6.0, 2.0, -2.0, 12.0, -12.0, 24.0, -18.0,
    -1.0, 0.0, 3.0, -6.0, 2.0, -5.0, 15.0, -13.0, 28.0, -21.0,
    -1.0, 0.0, 3.0, -6.0, 2.0, -5.0, 12.0, -11.0, 32.0, -24.0,
    -1.0, 0.0, 3.0, -6.0, 2.0, -5.0, 12.0, -14.0, 37.0, -26.0,
    -1.0, 0.0, 3.0, -6.0, 2.0, -5.0, 12.0, -14.0, 36.0, -25.0,
    1.0, 0.0, 0.0360, 0.0796,
    1.9867, 0.0, 7.4283e-05, 7.4025e-06,
    2.0, 0.002505, 1.4346e-04, 6.7839e-07,
    2.0, -0.002505, 1.4346e-04, 6.7839e-07,
    2.0067, 0.0118, 6.7873e-05, 5.7496e-06,
    2.0067, -0.0118, 6.7873e-05, 5.7496e-06,
    2.9970, 0.0, 9.2779e-05, 2.6519e-06,
    3.0, 8.7028e-04, 2.7358e-04, 1.9407e-07,
    3.0, -8.7028e-04, 2.7358e-04, 1.9407e-07,
    3.0030, 0.0, 9.2696e-05, 2.6477e-06,
};

static const int dget37_n[] = {
    1, 1, 2, 2, 2, 6, 4, 5, 5, 6,
    6, 6, 4, 6, 5, 10, 4, 6, 10, 4,
    6, 4, 3, 6, 6, 6, 6, 6, 12, 6,
    6, 6, 6, 8, 6, 4, 5, 6, 10,
};

static void rowmajor_to_colmajor(const f64* rows, f64* cm, int n, int ldcm)
{
    memset(cm, 0, (size_t)ldcm * n * sizeof(f64));
    for (int i = 0; i < n; i++)
        for (int j = 0; j < n; j++)
            cm[i + j * ldcm] = rows[i * n + j];
}

void dget37(f64 rmax[3], int lmax[3], int ninfo[3], int* knt)
{
    const f64 ZERO = 0.0;
    const f64 ONE  = 1.0;
    const f64 TWO  = 2.0;
    const f64 EPSIN = 5.9605e-8;

    int    i, icmp, ifnd, info, iscl, j, kmin, m, n;
    f64    bignum, eps, smlnum, tnrm, tol, tolin, v,
           vimin, vmax, vmul, vrmin;

    int    select[LDT];
    int    iwork[2 * LDT], lcmp[3];
    f64    dum[1], le[LDT * LDT], re[LDT * LDT],
           s[LDT], sep[LDT], sepin[LDT],
           septmp[LDT], sin_vals[LDT], stmp[LDT],
           t[LDT * LDT], tmp[LDT * LDT], val[3],
           wi[LDT], witmp[LDT],
           work[LWORK], wr[LDT],
           wrtmp[LDT];

    eps = dlamch("P");
    smlnum = dlamch("S") / eps;
    bignum = ONE / smlnum;

    eps = fmax(eps, EPSIN);
    rmax[0] = ZERO;
    rmax[1] = ZERO;
    rmax[2] = ZERO;
    lmax[0] = 0;
    lmax[1] = 0;
    lmax[2] = 0;
    *knt = 0;
    ninfo[0] = 0;
    ninfo[1] = 0;
    ninfo[2] = 0;

    val[0] = sqrt(smlnum);
    val[1] = ONE;
    val[2] = sqrt(bignum);

    int data_offset = 0;

    for (int icase = 0; icase < NCASES37; icase++) {
        n = dget37_n[icase];

        rowmajor_to_colmajor(&dget37_data[data_offset], tmp, n, LDT);
        data_offset += n * n;

        for (i = 0; i < n; i++) {
            sin_vals[i] = dget37_data[data_offset + i * 4 + 2];
            sepin[i]   = dget37_data[data_offset + i * 4 + 3];
        }
        data_offset += n * 4;

        tnrm = dlange("M", n, n, tmp, LDT, work);

        for (iscl = 0; iscl < 3; iscl++) {

            *knt = *knt + 1;
            dlacpy("F", n, n, tmp, LDT, t, LDT);
            vmul = val[iscl];
            for (i = 0; i < n; i++)
                cblas_dscal(n, vmul, &t[i * LDT], 1);
            if (tnrm == ZERO)
                vmul = ONE;

            dgehrd(n, 0, n - 1, t, LDT, &work[0], &work[n], LWORK - n,
                   &info);
            if (info != 0) {
                lmax[0] = *knt;
                ninfo[0] = ninfo[0] + 1;
                continue;
            }
            for (j = 0; j < n - 2; j++)
                for (i = j + 2; i < n; i++)
                    t[i + j * LDT] = ZERO;

            dhseqr("S", "N", n, 0, n - 1, t, LDT, wr, wi, dum, 1, work,
                   LWORK, &info);
            if (info != 0) {
                lmax[1] = *knt;
                ninfo[1] = ninfo[1] + 1;
                continue;
            }

            dtrevc("Both", "All", select, n, t, LDT, le, LDT, re,
                   LDT, n, &m, work, &info);

            dtrsna("Both", "All", select, n, t, LDT, le, LDT, re,
                   LDT, s, sep, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }

            cblas_dcopy(n, wr, 1, wrtmp, 1);
            cblas_dcopy(n, wi, 1, witmp, 1);
            cblas_dcopy(n, s, 1, stmp, 1);
            cblas_dcopy(n, sep, 1, septmp, 1);
            cblas_dscal(n, ONE / vmul, septmp, 1);
            for (i = 0; i < n - 1; i++) {
                kmin = i;
                vrmin = wrtmp[i];
                vimin = witmp[i];
                for (j = i + 1; j < n; j++) {
                    if (wrtmp[j] < vrmin) {
                        kmin = j;
                        vrmin = wrtmp[j];
                        vimin = witmp[j];
                    }
                }
                wrtmp[kmin] = wrtmp[i];
                witmp[kmin] = witmp[i];
                wrtmp[i] = vrmin;
                witmp[i] = vimin;
                vrmin = stmp[kmin];
                stmp[kmin] = stmp[i];
                stmp[i] = vrmin;
                vrmin = septmp[kmin];
                septmp[kmin] = septmp[i];
                septmp[i] = vrmin;
            }

            v = fmax(TWO * (f64)n * eps * tnrm, smlnum);
            if (tnrm == ZERO)
                v = ONE;
            for (i = 0; i < n; i++) {
                if (v > septmp[i])
                    tol = ONE;
                else
                    tol = v / septmp[i];
                if (v > sepin[i])
                    tolin = ONE;
                else
                    tolin = v / sepin[i];
                tol = fmax(tol, smlnum / eps);
                tolin = fmax(tolin, smlnum / eps);
                if (eps * (sin_vals[i] - tolin) > stmp[i] + tol) {
                    vmax = ONE / eps;
                } else if (sin_vals[i] - tolin > stmp[i] + tol) {
                    vmax = (sin_vals[i] - tolin) / (stmp[i] + tol);
                } else if (sin_vals[i] + tolin < eps * (stmp[i] - tol)) {
                    vmax = ONE / eps;
                } else if (sin_vals[i] + tolin < stmp[i] - tol) {
                    vmax = (stmp[i] - tol) / (sin_vals[i] + tolin);
                } else {
                    vmax = ONE;
                }
                if (vmax > rmax[1]) {
                    rmax[1] = vmax;
                    if (ninfo[1] == 0)
                        lmax[1] = *knt;
                }
            }

            for (i = 0; i < n; i++) {
                if (v > septmp[i] * stmp[i])
                    tol = septmp[i];
                else
                    tol = v / stmp[i];
                if (v > sepin[i] * sin_vals[i])
                    tolin = sepin[i];
                else
                    tolin = v / sin_vals[i];
                tol = fmax(tol, smlnum / eps);
                tolin = fmax(tolin, smlnum / eps);
                if (eps * (sepin[i] - tolin) > septmp[i] + tol) {
                    vmax = ONE / eps;
                } else if (sepin[i] - tolin > septmp[i] + tol) {
                    vmax = (sepin[i] - tolin) / (septmp[i] + tol);
                } else if (sepin[i] + tolin < eps * (septmp[i] - tol)) {
                    vmax = ONE / eps;
                } else if (sepin[i] + tolin < septmp[i] - tol) {
                    vmax = (septmp[i] - tol) / (sepin[i] + tolin);
                } else {
                    vmax = ONE;
                }
                if (vmax > rmax[1]) {
                    rmax[1] = vmax;
                    if (ninfo[1] == 0)
                        lmax[1] = *knt;
                }
            }

            for (i = 0; i < n; i++) {
                if (sin_vals[i] <= (f64)(2 * n) * eps && stmp[i] <=
                    (f64)(2 * n) * eps) {
                    vmax = ONE;
                } else if (eps * sin_vals[i] > stmp[i]) {
                    vmax = ONE / eps;
                } else if (sin_vals[i] > stmp[i]) {
                    vmax = sin_vals[i] / stmp[i];
                } else if (sin_vals[i] < eps * stmp[i]) {
                    vmax = ONE / eps;
                } else if (sin_vals[i] < stmp[i]) {
                    vmax = stmp[i] / sin_vals[i];
                } else {
                    vmax = ONE;
                }
                if (vmax > rmax[2]) {
                    rmax[2] = vmax;
                    if (ninfo[2] == 0)
                        lmax[2] = *knt;
                }
            }

            for (i = 0; i < n; i++) {
                if (sepin[i] <= v && septmp[i] <= v) {
                    vmax = ONE;
                } else if (eps * sepin[i] > septmp[i]) {
                    vmax = ONE / eps;
                } else if (sepin[i] > septmp[i]) {
                    vmax = sepin[i] / septmp[i];
                } else if (sepin[i] < eps * septmp[i]) {
                    vmax = ONE / eps;
                } else if (sepin[i] < septmp[i]) {
                    vmax = septmp[i] / sepin[i];
                } else {
                    vmax = ONE;
                }
                if (vmax > rmax[2]) {
                    rmax[2] = vmax;
                    if (ninfo[2] == 0)
                        lmax[2] = *knt;
                }
            }

            vmax = ZERO;
            dum[0] = -ONE;
            cblas_dcopy(n, dum, 0, stmp, 1);
            cblas_dcopy(n, dum, 0, septmp, 1);
            dtrsna("Eigcond", "All", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < n; i++) {
                if (stmp[i] != s[i])
                    vmax = ONE / eps;
                if (septmp[i] != dum[0])
                    vmax = ONE / eps;
            }

            cblas_dcopy(n, dum, 0, stmp, 1);
            cblas_dcopy(n, dum, 0, septmp, 1);
            dtrsna("Veccond", "All", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < n; i++) {
                if (stmp[i] != dum[0])
                    vmax = ONE / eps;
                if (septmp[i] != sep[i])
                    vmax = ONE / eps;
            }

            for (i = 0; i < n; i++)
                select[i] = 1;
            cblas_dcopy(n, dum, 0, stmp, 1);
            cblas_dcopy(n, dum, 0, septmp, 1);
            dtrsna("Bothcond", "Some", select, n, t, LDT, le, LDT,
                   re, LDT, stmp, septmp, n, &m, work, n, iwork,
                   &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < n; i++) {
                if (septmp[i] != sep[i])
                    vmax = ONE / eps;
                if (stmp[i] != s[i])
                    vmax = ONE / eps;
            }

            cblas_dcopy(n, dum, 0, stmp, 1);
            cblas_dcopy(n, dum, 0, septmp, 1);
            dtrsna("Eigcond", "Some", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < n; i++) {
                if (stmp[i] != s[i])
                    vmax = ONE / eps;
                if (septmp[i] != dum[0])
                    vmax = ONE / eps;
            }

            cblas_dcopy(n, dum, 0, stmp, 1);
            cblas_dcopy(n, dum, 0, septmp, 1);
            dtrsna("Veccond", "Some", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < n; i++) {
                if (stmp[i] != dum[0])
                    vmax = ONE / eps;
                if (septmp[i] != sep[i])
                    vmax = ONE / eps;
            }
            if (vmax > rmax[0]) {
                rmax[0] = vmax;
                if (ninfo[0] == 0)
                    lmax[0] = *knt;
            }

            if (wi[0] == ZERO) {
                lcmp[0] = 0;
                ifnd = 0;
                for (i = 1; i < n; i++) {
                    if (ifnd == 1 || wi[i] == ZERO) {
                        select[i] = 0;
                    } else {
                        ifnd = 1;
                        lcmp[1] = i;
                        lcmp[2] = i + 1;
                        cblas_dcopy(n, &re[i * LDT], 1, &re[1 * LDT], 1);
                        cblas_dcopy(n, &re[(i + 1) * LDT], 1, &re[2 * LDT], 1);
                        cblas_dcopy(n, &le[i * LDT], 1, &le[1 * LDT], 1);
                        cblas_dcopy(n, &le[(i + 1) * LDT], 1, &le[2 * LDT], 1);
                    }
                }
                if (ifnd == 0) {
                    icmp = 1;
                } else {
                    icmp = 3;
                }
            } else {
                lcmp[0] = 0;
                lcmp[1] = 1;
                ifnd = 0;
                for (i = 2; i < n; i++) {
                    if (ifnd == 1 || wi[i] != ZERO) {
                        select[i] = 0;
                    } else {
                        lcmp[2] = i;
                        ifnd = 1;
                        cblas_dcopy(n, &re[i * LDT], 1, &re[2 * LDT], 1);
                        cblas_dcopy(n, &le[i * LDT], 1, &le[2 * LDT], 1);
                    }
                }
                if (ifnd == 0) {
                    icmp = 2;
                } else {
                    icmp = 3;
                }
            }

            cblas_dcopy(icmp, dum, 0, stmp, 1);
            cblas_dcopy(icmp, dum, 0, septmp, 1);
            dtrsna("Bothcond", "Some", select, n, t, LDT, le, LDT,
                   re, LDT, stmp, septmp, n, &m, work, n, iwork,
                   &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < icmp; i++) {
                j = lcmp[i];
                if (septmp[i] != sep[j])
                    vmax = ONE / eps;
                if (stmp[i] != s[j])
                    vmax = ONE / eps;
            }

            cblas_dcopy(icmp, dum, 0, stmp, 1);
            cblas_dcopy(icmp, dum, 0, septmp, 1);
            dtrsna("Eigcond", "Some", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < icmp; i++) {
                j = lcmp[i];
                if (stmp[i] != s[j])
                    vmax = ONE / eps;
                if (septmp[i] != dum[0])
                    vmax = ONE / eps;
            }

            cblas_dcopy(icmp, dum, 0, stmp, 1);
            cblas_dcopy(icmp, dum, 0, septmp, 1);
            dtrsna("Veccond", "Some", select, n, t, LDT, le, LDT, re,
                   LDT, stmp, septmp, n, &m, work, n, iwork, &info);
            if (info != 0) {
                lmax[2] = *knt;
                ninfo[2] = ninfo[2] + 1;
                continue;
            }
            for (i = 0; i < icmp; i++) {
                j = lcmp[i];
                if (stmp[i] != dum[0])
                    vmax = ONE / eps;
                if (septmp[i] != sep[j])
                    vmax = ONE / eps;
            }
            if (vmax > rmax[0]) {
                rmax[0] = vmax;
                if (ninfo[0] == 0)
                    lmax[0] = *knt;
            }

        } /* end iscl loop */
    } /* end icase loop */
}
